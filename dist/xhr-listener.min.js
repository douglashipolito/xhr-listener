/*! xhr-listener 14-07-2014 */
!function(){"use strict";Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null===this)throw new TypeError(" this is null or not defined");var e=Object(this),f=e.length>>>0;if("function"!=typeof a)throw new TypeError(a+" is not a function");for(arguments.length>1&&(c=b),d=0;f>d;){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}}),"function"!=typeof Object.create&&!function(){var a=function(){};Object.create=function(b){if(arguments.length>1)throw new Error("Second argument not supported");if(null===b)throw new Error("Cannot set a null [[Prototype]]");if("object"!=typeof b)throw new TypeError("Argument must be an object");return a.prototype=b,new a}}()}(window),function(a){"use strict";function b(a,c){if(!(this instanceof b)){var d=Object.create(b.prototype);return d.constructor.apply(d,arguments),d}this.path=a,c&&this.done(a,c)}function c(){function a(){b.before=this.before=function(){return f.callOrder="before",this},b.after=this.after=function(){return f.callOrder="after",this}}var b=this,c=k(arguments),d=c[0],e=c[1],f=c[2],g={};if(!d||"function"==typeof d)return console.error("the type of request must be a string"),!1;if("function"==typeof e){if("undefined"==typeof this.path)return console.error("please define a path to track"),!1;f=e,e=this.path}else this.path=e;return"string"==typeof this.path||this.path instanceof RegExp?(f.callOrder="before",g[e]=s[e]||{},g[e].path=e,g[e][d]=g[e][d]||[],g[e][d].push(f),s[e]=g[e],a.prototype=b,new a):(console.error("there is no path to track"),!1)}function d(a,b,c,d){var e=!1,f=function(a,b,c){return function(){a(b,c)}},g=[],i=[];return h(function(c,d){var e,h=0,j=[],k=0;for(e in d)if("[object Array]"===Object.prototype.toString.call(d[e])&&~a.indexOf(e))for(j=d[e],k=j.length;k>h;h++){if("before"===j[h].callOrder)return void g.push(f(b,d,j[h]));"after"===j[h].callOrder&&i.push(f(b,d,j[h]))}},d),g.forEach(function(a){a()}),e=c(),i.forEach(function(a){a()}),e}function e(a){var b=this,c=b.status>=200&&b.status<300||304===b.status;if(a.done&&c){var d=o(b.getResponseHeader("Content-Type"));b.is=p(d),b.responseOverwritable=l.call(b),a.done.forEach(function(a){a.call(b,b.responseText,b.response,d),b.responseOverwritable&&(b.newResponseText&&m.call(b,"responseText"),b.newResponse&&m.call(b,"response"))})}else a.error&&!c&&a.error.forEach(function(a){a.call(b,b.status,b.statusText)})}function f(a){var b=this;4===b.readyState&&e.call(b,a)}function g(a){return h(!1,a)}function h(a,b){var c=!1;return i(function(d){j(d.path,b)&&(a&&a(d.path,d),c=!0)}),c}function i(a){var b;for(b in s)a(s[b])}function j(a,b){return"string"!=typeof a?a.test(b):a===b}function k(a){return Array.prototype.slice.call(a)}function l(){try{return Object.defineProperty(this,"responseText",{configurable:!0}),!0}catch(a){return!1}}function m(a){var b=a,c="new"+b[0].toUpperCase()+b.slice(1),d=this[b];try{Object.defineProperty(this,b,{get:function(){return d},set:function(){return d=this[c]},configurable:!0}),this[b]=this[c]}catch(e){return!1}}function n(a,b){var c=this[a];try{Object.defineProperty(this,a,{get:function(){return c},set:function(a){return c=a,b.call(this,c),c},configurable:!0})}catch(d){return!1}}function o(a){return a.match("json")?"json":a.match("javascript")?"js":a.match("text")?"html":a.match("xml")?"xml":"text"}function p(a){return{html:"html"===a,json:"json"===a,js:"js"===a,text:"text"===a}}function q(a){var b={},c=!1;return a.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(a,d,e){b[d]=e,c=!0}),c?b:""}var r=function(){var b=a.XMLHttpRequest.prototype,c=["open","send"],d={};return d.proto=b,c.length||c.push("open"),c.forEach(function(a){d[a]=b[a]}),d}(),s={};b.prototype={constructor:b,onopen:function(a,b){return c.call(this,"onopen",a,b)},done:function(a,b){return c.call(this,"done",a,b)},error:function(a,b){return c.call(this,"error",a,b)},before:function(){},after:function(){}},b.getRequestsList=function(){return s},b.clearRequestsList=function(){s={}},r.proto.open=function(a,b){var c=this,e=arguments,h={onreadystatechange:!1};return c.url=b,g(c.url)?(c.params={get:q(b),post:{}},c.method=a.toLowerCase(),c.onreadystatechange&&(h.onreadystatechange=c.onreadystatechange),c.onreadystatechange=function(){var a=this,c=arguments,e=function(b){f.call(a,b)},g=function(){h.onreadystatechange&&h.onreadystatechange.apply(a,c)};d(["done","error"],e,g,b)},n.call(c,"onreadystatechange",function(a){h.onreadystatechange=a}),d(["onopen"],function(a,b){b.apply(c,e)},function(){return r.open.apply(c,e)},b)):r.open.apply(this,arguments)},r.proto.send=function(a){var b=this;return g(b.url)?(b.params.post=a?q(a):"",r.send.apply(b,arguments)):r.send.apply(b,arguments)},b.VERSION="0.0.1",a.XhrListener=b}(this);